{"version":3,"file":"eventlinker.min.js","sources":["../src/eventlinker.js"],"sourcesContent":["import Modal from 'core/modal';\nimport Ajax from \"../../../../lib/amd/src/ajax\";\n\n/**\n * Creates the event linker modal.\n *\n * @param {int} cmid\n * @param {int} homeworkid\n */\nexport const init = async(cmid, homeworkid) => {\n    // Add an eventlistener to the open event linker button.\n    document.querySelector('#open-event-linker').addEventListener('click', async()=>{\n\n        // Call the server to get all available events.\n        Ajax.call([{\n            methodname: 'mod_homework_get_events_for_homework',\n            args: {homeworkid: homeworkid},\n            done: async function(response) {\n                     // Create a modal for the user to link events and homework.\n                    const modal = await Modal.create({\n                        title: 'Homework event linker',\n                        body: response.events,\n                        footer: '<button type=\"button\" class=\"btn btn-primary\" data-action=\"submit\">Submit</button>\\n' +\n                                '<button type=\"button\" class=\"btn btn-secondary\" data-action=\"cancel\">Cancel</button>',\n                        show: true,\n                        removeOnClose: true,\n                    });\n\n                    modal.show();\n                    // If there is nothing to link then hide submit and cancel buttons.\n                    if (response.events.includes(\"There are no available events to link\")) {\n                        modal.hideFooter();\n                    }\n\n                    // Attach event listeners for buttons\n                    modal.getRoot().on('click', '[data-action=\"submit\"]', (e) => {\n                        e.preventDefault();\n                        submitEventLink(modal, homeworkid, cmid);\n                    });\n                    modal.getRoot().on('click', '[data-action=\"cancel\"]', (e) => {\n                        e.preventDefault();\n                        modal.destroy();\n                        location.reload();\n                    });\n            },\n            fail: (error) => {\n                console.error(\"Fail:\", error);\n            },\n        }]);\n\n\n    });\n\n\n};\n\n/**\n * Sumbits the event and homework to link.\n *\n * @param {modal} modal\n * @param {int} homeworkid\n * @param {int} cmid\n */\nfunction submitEventLink(modal, homeworkid, cmid) {\n\n    // Get the selected event\n    let form = document.getElementById(\"evntlinkerform\");\n    let selectedEvent = form.querySelector('input[name=\"eventtolink\"]:checked');\n\n    // If there are non click then complain\n\n    if (!selectedEvent) {\n        alert(\"Please select an event!\");\n    } else {\n        // Submit the event to link\n        Ajax.call([{\n            methodname: 'mod_homework_homework_event_link',\n            args: {homeworkid: homeworkid, course_module_id: cmid, eventid: selectedEvent.value},\n            done: async function(response) {\n                modal.destroy();\n                location.reload();\n            },\n            fail: (error) =>{\n                console.log(\"Error: \", error);\n            }\n        }]);\n    }\n\n\n}"],"names":["_interopRequireDefault","e","__esModule","default","_modal","_ajax","_exports","init","async","cmid","homeworkid","document","querySelector","addEventListener","Ajax","call","methodname","args","done","response","modal","Modal","create","title","body","events","footer","show","removeOnClose","includes","hideFooter","getRoot","on","preventDefault","selectedEvent","getElementById","course_module_id","eventid","value","destroy","location","reload","fail","error","console","log","alert","submitEventLink"],"mappings":"2HACgD,SAAAA,uBAAAC,GAAAA,OAAAA,GAAAA,EAAAC,WAAAD,EAAAE,CAAAA,QAAAF,EAAA,8EADhDG,OAAAJ,uBAAAI,QACAC,MAAAL,uBAAAK,OAqDEC,SAAAC,KA7CkBC,MAAMC,KAAMC,cAE5BC,SAASC,cAAc,sBAAsBC,iBAAiB,SAASL,UAGnEM,MAAIX,QAACY,KAAK,CAAC,CACPC,WAAY,uCACZC,KAAM,CAACP,WAAYA,YACnBQ,KAAMV,eAAeW,UAEb,MAAMC,YAAcC,OAAKlB,QAACmB,OAAO,CAC7BC,MAAO,wBACPC,KAAML,SAASM,OACfC,OAAQ,2KAERC,MAAM,EACNC,eAAe,IAGnBR,MAAMO,OAEFR,SAASM,OAAOI,SAAS,0CACzBT,MAAMU,aAIVV,MAAMW,UAAUC,GAAG,QAAS,0BAA2B/B,IACnDA,EAAEgC,iBA2B1B,SAAyBb,MAAOV,WAAYD,MAGxC,IACIyB,cADOvB,SAASwB,eAAe,kBACVvB,cAAc,qCAIlCsB,cAIDpB,MAAIX,QAACY,KAAK,CAAC,CACPC,WAAY,mCACZC,KAAM,CAACP,WAAYA,WAAY0B,iBAAkB3B,KAAM4B,QAASH,cAAcI,OAC9EpB,KAAMV,eAAeW,UACjBC,MAAMmB,UACNC,SAASC,QACZ,EACDC,KAAOC,QACHC,QAAQC,IAAI,UAAWF,MAAM,KAXrCG,MAAM,0BAiBd,CApDwBC,CAAgB3B,MAAOV,WAAYD,KAAK,IAE5CW,MAAMW,UAAUC,GAAG,QAAS,0BAA2B/B,IACnDA,EAAEgC,iBACFb,MAAMmB,UACNC,SAASC,QAAQ,GAE5B,EACDC,KAAOC,QACHC,QAAQD,MAAM,QAASA,MAAM,IAElC,GAGL,CAsCL"}